<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XalaBus</title>
  <link rel="icon" type="image/png" href="/icon.png">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    referrerpolicy="no-referrer">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="inicio.css" />
</head>

<body>
  <div class="w-100 h-100 d-flex flex-row">
    <div class="d-flex flex-row bg-white shadow-sm">
      <div class="d-flex flex-column border">
        <div class="d-flex flex-column px-2 py-3 gap-3">
          <button
            class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="window.location.href='/index.html'">
            <i class="fa-solid fa-house fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary" style="font-size: .8rem; margin-top: -.1rem;">Inicio</span>
          </button>
          <button
            class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="mostrarRutas()">
            <i class="fa-solid fa-bus-simple fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary" style="font-size: .8rem; margin-top: -.1rem;">Rutas</span>
          </button>
          <button
            class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="mostrarFavoritos()">
            <i class="fa-solid fa-bookmark fs-5 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary" style="font-size: .8rem; margin-top: -.1rem;">Favoritos</span>
          </button>
          <hr />
          <button
            class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="window.location.href='/paginas/foro/foro.html'">
            <i class="fa-solid fa-comments fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary" style="font-size: .8rem; margin-top: -.1rem;">Foro</span>
          </button>
          <button
            class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="mostrarCrearRutas()">
            <i class="fa-solid fa-route fs-5 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary" style="font-size: .8rem; margin-top: -.1rem;">Crear</span>
          </button>
        </div>
        <div class="d-flex flex-column px-2 py-3 gap-3 mt-auto align-items-center">
          <button class="menu-item btn btn-outline-primary d-flex flex-column p-0 border-0 bg-transparent text-primary"
            onclick="window.location.href='/index.html'">
            <i class="fa-solid fa-bell fs-4 p-2 rounded"></i>
          </button>
          <div class="dropdown">
            <img src="/images/avatar-default.png" alt="Avatar" class="border rounded-circle"
              style="min-width: 2rem; max-width: 2rem; min-height: 2rem; max-height: 2rem;" type="button"
              id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="/paginas/perfil/perfil.html">
                <i class="fa-solid fa-user me-2"></i>
                Perfil
              </a>
              <button class="dropdown-item" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket me-2"></i>
                Cerrar sesion
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="sidebar-content" class="overflow-auto"></div>
    </div>
    <div id="map" class="w-100 h-100 position-relative">
      <!-- Menu de busqueda -->
      <div id="menu" class="position-absolute col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5 top-0 start-50 translate-middle-x p-3 h-100"
          style="z-index: 1000; pointer-events: none;">
        <div id="busqueda" class="d-flex flex-column mx-auto bg-white shadow-sm border overflow-hidden"
          style="border-radius: 1.3rem; height: fit-content; min-height: 0; max-height: 100%; pointer-events: auto;">
          <div class="d-flex justify-content-center align-items-center gap-1 p-1 px-2">
            <i class="fa-solid fa-magnifying-glass fs-6 ps-2 text-muted" style="padding-top: .1rem;"></i>
            <input type="text" id="buscar-ruta" style="padding: .3rem .5rem .2rem .5rem;"
              class="form-control form-control-sm border-0 w-100 rounded-5 shadow-none"
              placeholder="Escribe una calle o lugar..." oninput="filtrarRutas()" onfocus="reMostrarResultados()">
            <button id="btn-limpiar" class="btn btn-sm btn-outline-secondary bg-transparent border-0 p-0 d-none d-flex"
              onclick="limpiarBusqueda()">
              <i class="fa-solid fa-xmark pe-2" style="font-size: 1.1rem;"></i>
            </button>
          </div>
          <div id="resultados-busqueda" class="d-flex flex-column d-none overflow-auto"></div>
        </div>
      </div>
    </div>

    <div id="sidebar-izquierdo" class="d-none position-absolute top-0 start-0 px-3 pb-3 h-100"
      style="z-index: 900; padding-top: 5.5rem;">
      <div class="d-flex flex-column p-3 rounded h-100 shadow-sm overflow-auto">
        <h4 class="fw-bold">Rutas</h4>
        <div id="lista-rutas" class="d-flex flex-column gap-2 mt-3"></div>

        <a class="btn btn-primary mt-2" href="/paginas/foro/foro.html">
          <i class="fa-solid fa-comments me-1"></i>
          Foro / Comunidad
        </a>

        <!-- <a class="btn btn-warning mt-2 w-100 d-flex align-items-center justify-content-center" href="#"
        onclick="verFavoritos()" data-bs-toggle="collapse" data-bs-target="#lista-favoritos" aria-expanded="false"
        aria-controls="lista-favoritos">
        <i class="fa-solid fa-bookmark me-2"></i>
        Favoritos
      </a> -->



        <!-- <button class="btn btn-success mt-3" onclick="alternarMenuDerecho()">
        <i class="fa-solid fa-route me-1"></i>
        Crear ruta personalizada
      </button> -->

      </div>
    </div>

    <div id="crear-rutas" class="d-none">
      <div class="d-flex flex-column p-3">
        <h5 class="fw-bold">Crear rutas</h5>

        <!-- Instrucciones para modal -->
        <button type="button" class="btn btn-secondary mt-2 w-100 d-flex align-items-center justify-content-center"
          data-bs-toggle="modal" data-bs-target="#instruccionesModal">
          <i class="fa-solid fa-circle-info me-2"></i>
          Ver instrucciones
        </button>

        <div id="generar-rutas" class="d-flex flex-column gap-2 mt-2"></div>

        <form id="form-ruta" class="mt-4">
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="nombre-ruta" placeholder="Nombre de la ruta" required>
            <input type="color" class="form-control form-control-color" id="color-ruta" value="#ff0000"
              title="Color de la ruta">
          </div>
          <div id="lista-puntos"></div>
          <div class="d-flex gap-1">
            <button class="btn btn-danger w-100 mt-2" type="button" onclick="limpiarFormulario()">
              <i class="fa-solid fa-floppy-disk me-1"></i>
              Limpiar
            </button>
            <button class="btn btn-success w-100 mt-2" type="submit">
              <i class="fa-solid fa-floppy-disk me-1"></i>
              Guardar
            </button>
          </div>
        </form>
        <button class="btn btn-danger mt-3" onclick="limpiarMarcadores()">
          <i class="fa-solid fa-trash me-1"></i>
          Limpiar marcadores
        </button>
        <button class="btn btn-danger mt-2" onclick="borrarLocalStorage()">
          <i class="fa-solid fa-trash me-1"></i>
          Borrar cache de rutas
        </button>
      </div>
    </div>

    <!-- Modal Bienvenida -->
    <div class="modal fade" id="bienvenidaModal" tabindex="-1" aria-labelledby="bienvenidaModalLabel" aria-hidden="true"
      data-bs-backdrop="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-body text-center px-4 pb-0">
            <h2 class="fw-bold mt-2 mb-3" id="bienvenidaModalLabel">¡Bienvenido a XalaBus!</h2>
            <p>Esta aplicación te permite visualizar las rutas de autobús en Xalapa y crear tus propias rutas
              personalizadas.</p>
            <p class="fw-bold">Disfruta de todo nuestro contenido:</p>
            <div class="d-flex justify-content-center gap-3 mb-3">
              <div
                class="d-flex flex-column justify-content-center align-items-center bg-primary text-white p-3 rounded-circle gap-1 shadow-sm"
                style="width: 6rem; height: 6rem;">
                <i class="fa-solid fa-bookmark fa-2x"></i>
                <p class="m-0 fw-semibold">Favoritos</p>
              </div>
              <div
                class="d-flex flex-column justify-content-center align-items-center text-white p-3 rounded-circle gap-1 shadow-sm"
                style="width: 6rem; height: 6rem; background-color: rgb(255, 148, 8);">
                <i class="fa-solid fa-comments fa-2x"></i>
                <p class="m-0 fw-semibold">Foro</p>
              </div>
              <div
                class="d-flex flex-column justify-content-center align-items-center bg-success text-white p-3 rounded-circle gap-1 shadow-sm"
                style="width: 6rem; height: 6rem;">
                <i class="fa-solid fa-bus-simple fa-2x"></i>
                <p class="m-0 fw-semibold">Rutas</p>
              </div>
            </div>
            <div class="form-check w-auto d-flex justify-content-center mt-4">
              <input type="checkbox" id="no-mostrar" class="form-check-input me-2">
              <label for="no-mostrar" class="form-check-label">No mostrar de nuevo</label>
            </div>
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button type="button" id="btn-comenzar" class="btn btn-primary flex-fill"
              data-bs-dismiss="modal">Comenzar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Instrucciones -->
    <div class="modal fade" id="instruccionesModal" tabindex="-1" aria-labelledby="instruccionesModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-sm">
          <div class="modal-header">
            <h5 class="modal-title fw-bold" id="instruccionesModalLabel">Instrucciones</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ol class="list-group list-group-numbered">
              <li class="list-group-item">Haz clic en el mapa para agregar puntos a tu ruta personalizada.</li>
              <li class="list-group-item">Arrastra los marcadores para ajustar su posición.</li>
              <li class="list-group-item">Usa el botón de la papelera o haz clic derecho en un marcador para eliminarlo.
              </li>
              <li class="list-group-item">Arrastra y suelta los puntos en la lista para reordenarlos.</li>
              <li class="list-group-item">Completa el formulario y guarda tu ruta personalizada.</li>
            </ol>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success flex-fill" data-bs-dismiss="modal">Aceptar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Horario -->
    <div class="modal fade" id="horarioModal" tabindex="-1" aria-labelledby="horarioModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header">
            <h5 class="modal-title fw-bold" id="horarioModalLabel">Horario de Ruta</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body text-center">
            <p id="horario-texto">Aquí aparecerá el horario de la ruta seleccionada.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/pouchdb@9.0.0/dist/pouchdb.js"></script>
  <script src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@latest/L.TileLayer.PouchDBCached.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="inicio.js"></script>
  <script type="module" src="util.js"></script>

</body>

</html>