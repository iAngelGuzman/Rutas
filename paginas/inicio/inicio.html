<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- configuración head -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XalaBus</title>
    <link rel="icon" type="image/png" href="/icon.png">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      referrerpolicy="no-referrer">
    <link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet"
      href="/node_modules/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="inicio.css" />
  </head>

  <body>

    <div class="w-100 h-100 d-flex flex-row">
      
      <div class="d-none d-md-flex flex-row bg-white shadow-sm">
        <div class="d-flex flex-column border">
          <!-- menú principal -->
          <div class="d-flex flex-column px-2 py-3 gap-3">
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="window.location.href='/index.html'">
              <i
                class="fa-solid fa-house fs-5 p-2 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Inicio</span>
            </button>
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="actualizarSidebar('rutas')">
              <i
                class="fa-solid fa-bus-simple fs-5 p-2 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Rutas</span>
            </button>
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="actualizarSidebar('favoritos')">
              <i
                class="fa-solid fa-bookmark fs-5 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Favoritos</span>
            </button>
            <hr />
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="window.location.href='/paginas/foro/foro.html'">
              <i
                class="fa-solid fa-comments fs-5 p-2 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Foro</span>
            </button>
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="actualizarSidebar('crear')">
              <i
                class="fa-solid fa-route fs-5 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Crear</span>
            </button>
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column justify-content-center align-items-center p-0 border-0 bg-transparent text-primary"
              onclick="actualizarSidebar('mis-rutas')">
              <i
                class="fa-solid fa-route fs-5 rounded d-flex justify-content-center align-items-center"
                style="width: 2.4rem; height: 2.4rem;"></i>
              <span class="text-primary"
                style="font-size: .8rem; margin-top: -.1rem;">Creadas</span>
            </button>
          </div>
          
          <!-- menu inferior usuario -->
          <div
            class="d-flex flex-column px-2 py-3 gap-3 mt-auto align-items-center">
            <button
              class="menu-item btn btn-outline-primary d-flex flex-column p-0 border-0 bg-transparent text-primary"
              onclick="window.location.href='/index.html'">
              <i class="fa-solid fa-bell fs-4 p-2 rounded"></i>
            </button>
            <div class="dropdown">
              <img src="/images/avatar-default.png" alt="Avatar"
                class="w-100 h-100 rounded-circle border shadow-sm"
                type="button"
                style="width: 2rem; height: 2rem; max-width: 2rem; max-height: 2rem; min-width: 2rem; min-height: 2rem; object-fit: cover;"
                id="dropdownMenuButton" data-bs-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item d-none"
                  href="/paginas/perfil/perfil.html" id="perfil-user">
                  <i class="fa-solid fa-user me-2"></i>
                  Perfil
                </a>
                <button class="dropdown-item d-none" onclick="cerrarSesion()"
                  id="perfil-logout">
                  <i class="fa-solid fa-right-from-bracket me-2"></i>
                  Cerrar sesión
                </button>
                <a class="dropdown-item d-none" href="/paginas/login/login.html"
                  id="perfil-login">
                  <i class="fa-solid fa-right-to-bracket me-2"></i>
                  Iniciar sesión
                </a>
                <a class="dropdown-item d-none"
                  href="/paginas/signup/signup.html" id="perfil-signup">
                  <i class="fa-solid fa-user-plus me-2"></i>
                  Registrarse
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- mapa principal -->
      <div id="map" class="w-100 h-100 position-relative" style="cursor: auto;">

        <div id="sidebar-content"
          class="position-absolute overflow-auto bg-white h-100"
          style="z-index: 1010 !important; pointer-events: auto;"></div>

        <!-- barra de busqueda -->
        <div id="menu"
          class="position-absolute col-12 col-md-8 col-lg-6 col-xl-5 top-0 start-50 translate-middle-x p-0 p-md-3 h-100"
          style="z-index: 1000 !important; pointer-events: none;">
          
          <!-- header movil -->
          <div id="menu-movil"
            class="d-flex d-md-none gap-2 p-2 px-3 border-bottom bg-white mb-1 shadow-sm"
            style="pointer-events: auto;">
            <button class="btn btn-primary d-flex p-0"
              style="width: 2rem; height: 2rem;" onclick="abrirMenuMovil()">
              <i class="fa-solid fa-bars m-auto"></i>
            </button>
            <h3 class="text-primary fw-bold my-auto p-0 mx-auto">XalaBus</h3>
            <div class="dropdown">
              <img src="/images/avatar-default.png" alt="Avatar"
                class="w-100 h-100 rounded-circle border shadow-sm my-auto"
                type="button"
                style="width: 2rem; height: 2rem; max-width: 2rem; max-height: 2rem; min-width: 2rem; min-height: 2rem; object-fit: cover;"
                id="dropdownMenuButtonMovil" data-bs-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
              <div class="dropdown-menu"
                aria-labelledby="dropdownMenuButtonMovil">
                <a class="dropdown-item d-none"
                  href="/paginas/perfil/perfil.html" id="perfil-user-movil">
                  <i class="fa-solid fa-user me-2"></i>
                  Perfil
                </a>
                <button class="dropdown-item d-none" onclick="cerrarSesion()"
                  id="perfil-logout-movil">
                  <i class="fa-solid fa-right-from-bracket me-2"></i>
                  Cerrar sesión
                </button>
                <a class="dropdown-item d-none" href="/paginas/login/login.html"
                  id="perfil-login-movil">
                  <i class="fa-solid fa-right-to-bracket me-2"></i>
                  Iniciar sesión
                </a>
                <a class="dropdown-item d-none"
                  href="/paginas/registro/registro.html"
                  id="perfil-signup-movil">
                  <i class="fa-solid fa-user-plus me-2"></i>
                  Registrarse
                </a>
              </div>
            </div>
          </div>
          
          <!-- barra de busqueda principal -->
          <div id="busqueda"
            class="d-flex flex-column mx-auto bg-white shadow-sm border overflow-hidden"
            style="border-radius: 1.3rem; height: fit-content; min-height: 0; max-height: 100%; pointer-events: auto;">
            <div
              class="d-flex justify-content-center align-items-center gap-1 p-1 px-2">
              <i class="fa-solid fa-magnifying-glass fs-6 ps-2 text-muted"
                style="padding-top: .1rem;"></i>
              <input type="text" id="buscar-ruta"
                style="padding: .3rem .5rem .2rem .5rem;"
                class="form-control form-control-sm border-0 w-100 rounded-5 shadow-none"
                placeholder="Escribe una calle o lugar..."
                oninput="filtrarRutas()" onfocus="reMostrarResultados()">
              <button id="btn-limpiar"
                class="btn btn-sm btn-outline-secondary bg-transparent border-0 p-0 d-none d-flex"
                onclick="limpiarBusqueda()">
                <i class="fa-solid fa-xmark pe-2"
                  style="font-size: 1.1rem;"></i>
              </button>
            </div>
            <div id="resultados-busqueda"
              class="d-flex flex-column d-none overflow-auto"></div>
          </div>
        </div>
      </div>

      <!-- panel crear rutas -->
      <div id="crear-rutas" class="d-none">
        <div class="d-flex flex-column p-3">
          <div class="d-flex justify-content-start align-items-center">
              <button class="close-btn btn btn-outline-secondary bg-transparent border-0 fs-3 p-0 d-flex d-md-none" onclick="abrirMenuMovil()">
                  <i class="fa-solid fa-circle-arrow-left"></i>
              </button>
              <h4 class="fw-bold m-0">Crear Rutas</h4>
          </div>

          <!-- botón instrucciones -->
          <button type="button"
            class="btn btn-sm btn-secondary mt-3 w-100 d-flex align-items-center justify-content-center"
            data-bs-toggle="modal" data-bs-target="#instruccionesModal">
            <i class="fa-solid fa-circle-info me-2"></i>
            Ver instrucciones
          </button>

          <div id="generar-rutas" class="d-flex flex-column gap-2 mt-2"></div>

          <!-- crear ruta -->
          <form id="form-ruta" class="mt-3">
            <div class="d-grid bg-dark position-relative" style="width: 20rem; height: 12rem;">
              <!-- Imagen de fondo -->
              <img id="fondo-imagen" src="${imagen}" alt="Logo" class="img-fluid"
                style="width: 20rem; height: 12rem; object-fit: cover; grid-area: 1 / 1; filter: blur(2px) brightness(0.5);">

              <!-- Imagen principal (frontal) -->
              <img id="imagen-principal" src="https://cdn-icons-png.freepik.com/512/13434/13434886.png" alt="Logo" class="img-fluid"
                style="width: 20rem; height: 12rem; object-fit: contain; grid-area: 1 / 1; z-index: 1; cursor: pointer;"
                onclick="document.getElementById('input-imagen').click()">

              <!-- Input oculto para seleccionar imagen -->
              <input type="file" id="input-imagen" accept="image/*"
                style="display: none;" onchange="cargarNuevaImagen(event)">
            </div>

            <input type="text" class="form-control mt-2" id="nombre-ruta"
                placeholder="Nombre de la ruta" required>
            <div class="input-group mt-2">
              <label for="color-ruta" class="input-group-text text-muted">Color</label>
              <input type="color" class="form-control form-control-color"
                id="color-ruta" value="#ff0000"
                title="Color de la ruta">
            </div>

            <!-- horario -->
            <div class="input-group mt-2">
              <label for="horario-ruta" class="input-group-text text-muted m-0"
                style="font-size: .9rem;">Horario:</label>
              <input type="text" class="form-control form-control-sm w-50"
                id="horario-ruta" placeholder="Ejemplo: 6:00 AM - 10:00 PM">
            </div>

            <!-- mujer segura checkbox -->
            <div class="form-check ms-1 mt-3" style="font-size: .9rem;">
              <input class="form-check-input" type="checkbox"
                id="mujer-segura">
              <label class="form-check-label text-muted" for="mujer-segura">
                Ruta Mujer Segura
              </label>
            </div>
            
            <div class="text-muted fs-6 mt-3 mb-2">
              <i class="fa-solid fa-list-ul ms-1 me-2"></i>Lista de puntos
            </div>
            <div id="lista-puntos"></div>
            <div class="d-flex gap-1 mt-3">
              <button class="btn btn-danger w-100" type="button"
                onclick="limpiarFormulario()">
                <i class="fa-solid fa-trash me-1"></i>
                Limpiar
              </button>
              <button class="btn btn-success w-100" type="submit">
                <i class="fa-solid fa-floppy-disk me-1"></i>
                Guardar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- bienvenida -->
      <div class="modal fade" id="bienvenidaModal" tabindex="-1"
        aria-labelledby="bienvenidaModalLabel" aria-hidden="true"
        data-bs-backdrop="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content shadow">
            <div class="modal-body text-center px-4 pb-0">
              <h2 class="fw-bold mt-2 mb-3"
                id="bienvenidaModalLabel">¡Bienvenido a XalaBus!</h2>
              <p>Esta aplicación te permite visualizar las rutas de autobús en
                Xalapa y crear tus propias rutas
                personalizadas.</p>
              <p class="fw-bold">Disfruta de todo nuestro contenido:</p>
              <div class="d-flex justify-content-center gap-3 mb-3">
                <div
                  class="d-flex flex-column justify-content-center align-items-center bg-primary text-white p-3 rounded-circle gap-1 shadow-sm"
                  style="width: 6rem; height: 6rem;">
                  <i class="fa-solid fa-bookmark fa-2x"></i>
                  <p class="m-0 fw-semibold">Favoritos</p>
                </div>
                <div
                  class="d-flex flex-column justify-content-center align-items-center text-white p-3 rounded-circle gap-1 shadow-sm"
                  style="width: 6rem; height: 6rem; background-color: rgb(255, 148, 8);">
                  <i class="fa-solid fa-comments fa-2x"></i>
                  <p class="m-0 fw-semibold">Foro</p>
                </div>
                <div
                  class="d-flex flex-column justify-content-center align-items-center bg-success text-white p-3 rounded-circle gap-1 shadow-sm"
                  style="width: 6rem; height: 6rem;">
                  <i class="fa-solid fa-bus-simple fa-2x"></i>
                  <p class="m-0 fw-semibold">Rutas</p>
                </div>
              </div>
              <div class="form-check w-auto d-flex justify-content-center mt-4">
                <input type="checkbox" id="no-mostrar"
                  class="form-check-input me-2">
                <label for="no-mostrar" class="form-check-label">No mostrar de
                  nuevo</label>
              </div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
              <button type="button" id="btn-comenzar"
                class="btn btn-primary flex-fill"
                data-bs-dismiss="modal">Comenzar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- instrucciones -->
      <div class="modal fade" id="instruccionesModal" tabindex="-1"
        aria-labelledby="instruccionesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content modal-sm">
            <div class="modal-header">
              <h5 class="modal-title fw-bold"
                id="instruccionesModalLabel">Instrucciones</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ol class="list-group list-group-numbered">
                <li class="list-group-item">Haz clic en el mapa para agregar
                  puntos a tu ruta personalizada.</li>
                <li class="list-group-item">Arrastra los marcadores para ajustar
                  su posición.</li>
                <li class="list-group-item">Usa el botón de la papelera o haz
                  clic derecho en un marcador para eliminarlo.
                </li>
                <li class="list-group-item">Arrastra y suelta los puntos en la
                  lista para reordenarlos.</li>
                <li class="list-group-item">Completa el formulario y guarda tu
                  ruta personalizada.</li>
              </ol>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success flex-fill"
                data-bs-dismiss="modal">Aceptar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- horario -->
      <div class="modal fade" id="horarioModal" tabindex="-1"
        aria-labelledby="horarioModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content shadow">
            <div class="modal-header">
              <h5 class="modal-title fw-bold" id="horarioModalLabel">Horario de
                Ruta</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"
                aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center">
              <p id="horario-texto">Aquí aparecerá el horario de la ruta
                seleccionada.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary"
                data-bs-dismiss="modal">Aceptar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- menú movil -->
    <div id="contenedor-movil"
      class="position-absolute w-100 h-100 top-0 start-0"
      style="z-index: 1000;">
      <div id="overlay" class="bg-black w-100 h-100"
        onclick="cerrarMenuMovil()"></div>
      <div id="contenido-movil"
        class="position-absolute bg-white h-100 top-0 start-0">
        <div class="d-flex flex-column p-3 gap-1">
          <button
            class="menu-item-movil btn btn-outline-primary d-flex flex-row justify-content-start align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="window.location.href='/index.html'">
            <i
              class="fa-solid fa-house fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary pe-2"
              style="font-size: .9rem; margin-top: -.1rem;">Inicio</span>
          </button>
          <button
            class="menu-item-movil btn btn-outline-primary d-flex flex-row justify-content-start align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="actualizarSidebar('rutas')">
            <i
              class="fa-solid fa-bus-simple fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary pe-2"
              style="font-size: .9rem; margin-top: -.1rem;">Rutas</span>
          </button>
          <button
            class="menu-item-movil btn btn-outline-primary d-flex flex-row justify-content-start align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="actualizarSidebar('favoritos')">
            <i
              class="fa-solid fa-bookmark fs-5 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary pe-2"
              style="font-size: .9rem; margin-top: -.1rem;">Favoritos</span>
          </button>
          <hr />
          <button
            class="menu-item-movil btn btn-outline-primary d-flex flex-row justify-content-start align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="window.location.href='/paginas/foro/foro.html'">
            <i
              class="fa-solid fa-comments fs-5 p-2 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary pe-2"
              style="font-size: .9rem; margin-top: -.1rem;">Foro</span>
          </button>
          <button
            class="menu-item-movil btn btn-outline-primary d-flex flex-row justify-content-start align-items-center p-0 border-0 bg-transparent text-primary"
            onclick="actualizarSidebar('crear')">
            <i
              class="fa-solid fa-route fs-5 rounded d-flex justify-content-center align-items-center"
              style="width: 2.4rem; height: 2.4rem;"></i>
            <span class="text-primary pe-2"
              style="font-size: .9rem; margin-top: -.1rem;">Crear</span>
          </button>
        </div>
      </div>

    </div>

    <div id="swal-container"></div>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/pouchdb@9.0.0/dist/pouchdb.js"></script>
    <script
      src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@latest/L.TileLayer.PouchDBCached.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="/node_modules/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="inicio.js"></script>
    <script type="module" src="util.js"></script>

  </body>

</html>